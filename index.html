<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ±çš„å‘Šç™½</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #ffebee;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            text-align: center;
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            width: 500px;
            animation: fadeIn 1s;
        }
        h1 {
            color: #e91e63;
            margin-bottom: 20px;
        }
        p {
            font-size: 18px;
            line-height: 1.6;
            color: #555;
            margin-bottom: 25px;
        }
        .heart {
            color: #e91e63;
            font-size: 24px;
            animation: beat 1s infinite alternate;
            display: inline-block;
        }
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        button {
            background-color: #e91e63;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        button:hover {
            transform: scale(1.05);
        }
        #noBtn {
            background-color: #9e9e9e;
        }
        #yesBtn:hover {
            background-color: #c2185b;
        }
        #noBtn:hover {
            background-color: #757575;
        }
        .hidden {
            display: none;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background-color: #f8f8f8;
        }
        .share-link {
            margin-top: 20px;
            word-break: break-all;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        input {
            padding: 10px 15px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 25px;
            width: 80%;
            max-width: 300px;
            margin-bottom: 20px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes beat {
            to { transform: scale(1.2); }
        }
    </style>
</head>
<body>
    <div class="container" id="creatorView">
        <h1>åˆ›å»ºä½ çš„è¡¨ç™½ <span class="heart">â¤</span></h1>
        <p>è¾“å…¥ä½ å¿ƒä»ªçš„äººçš„åå­—ï¼Œç”Ÿæˆä¸“å±è¡¨ç™½é“¾æ¥</p>
        <input type="text" id="loverName" placeholder="è¾“å…¥TAçš„åå­—">
        <button onclick="generateLink()">ç”Ÿæˆè¡¨ç™½é“¾æ¥</button>
        <div id="linkContainer" class="hidden">
            <p>å¤åˆ¶ä¸‹é¢çš„é“¾æ¥å‘é€ç»™TAï¼š</p>
            <div class="share-link" id="shareLink"></div>
            <p>å½“TAåšå‡ºé€‰æ‹©åï¼Œç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œï¼š</p>
            <div class="result" id="resultDisplay">ç­‰å¾…å›åº”ä¸­...</div>
        </div>
    </div>
    
    <div class="container hidden" id="receiverView">
        <h1>äº²çˆ±çš„<span id="displayName"></span> <span class="heart">â¤</span></h1>
        <p>ä»é‡è§ä½ çš„é‚£ä¸€åˆ»èµ·ï¼Œæˆ‘çš„ä¸–ç•Œå°±å˜å¾—ä¸ä¸€æ ·äº†ã€‚</p>
        <p>ä½ çš„ç¬‘å®¹åƒé˜³å…‰ä¸€æ ·æ¸©æš–ï¼Œä½ çš„å£°éŸ³æ˜¯æˆ‘æœ€å–œæ¬¢çš„æ—‹å¾‹ã€‚</p>
        <p>æˆ‘æƒ³å‘Šè¯‰ä½ ï¼š<strong>æˆ‘å–œæ¬¢ä½ </strong>ï¼Œæ¯”ä½ èƒ½æƒ³è±¡çš„è¿˜è¦å¤šã€‚</p>
        <div class="btn-group">
            <button id="yesBtn" onclick="respond(true)">æˆ‘æ„¿æ„</button>
            <button id="noBtn" onclick="respond(false)">å†è€ƒè™‘ä¸‹</button>
        </div>
    </div>
    
    <div class="container hidden" id="responseView">
        <h1><span class="heart">â¤</span> è°¢è°¢ä½ çš„å›åº” <span class="heart">â¤</span></h1>
        <p id="responseText"></p>
        <button onclick="location.reload()">è¿”å›</button>
    </div>
    
    <script>
        // æ£€æŸ¥URLå‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const nameParam = urlParams.get('to');
        const choiceParam = urlParams.get('choice');
        const fromParam = urlParams.get('from');
        
        // å¦‚æœæ˜¯æ¥æ”¶è€…æŸ¥çœ‹é¡µé¢
        if (nameParam && !choiceParam) {
            document.getElementById('creatorView').classList.add('hidden');
            document.getElementById('receiverView').classList.remove('hidden');
            document.getElementById('displayName').textContent = nameParam;
        }
        // å¦‚æœæ˜¯åˆ›å»ºè€…æŸ¥çœ‹ç»“æœ
        else if (fromParam && choiceParam) {
            document.getElementById('creatorView').classList.add('hidden');
            document.getElementById('receiverView').classList.add('hidden');
            document.getElementById('responseView').classList.remove('hidden');
            
            const responseText = choiceParam === 'true' 
                ? `å¥½æ¶ˆæ¯ï¼${nameParam}æ¥å—äº†ä½ çš„è¡¨ç™½ï¼ğŸ‰` 
                : `${nameParam}è¿˜éœ€è¦æ—¶é—´è€ƒè™‘...`;
            
            document.getElementById('responseText').textContent = responseText;
        }
        
        // ç”Ÿæˆåˆ†äº«é“¾æ¥
        function generateLink() {
            const name = document.getElementById('loverName').value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥åå­—');
                return;
            }
            
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('to', name);
            
            document.getElementById('shareLink').textContent = currentUrl.toString();
            document.getElementById('linkContainer').classList.remove('hidden');
            
            // å­˜å‚¨åå­—åˆ°æœ¬åœ°ï¼Œç”¨äºæ£€æŸ¥ç»“æœ
            localStorage.setItem('waitingForResponse', name);
        }
        
        // å›åº”è¡¨ç™½
        function respond(choice) {
            const name = urlParams.get('to');
            if (!name) return;
            
            // æ„å»ºç»“æœURL
            const resultUrl = new URL(window.location.href);
            resultUrl.searchParams.set('from', 'creator');
            resultUrl.searchParams.set('choice', choice);
            
            // æ˜¾ç¤ºå›åº”
            document.getElementById('receiverView').classList.add('hidden');
            document.getElementById('responseView').classList.remove('hidden');
            
            const responseText = choice 
                ? `æˆ‘ä¹Ÿå–œæ¬¢ä½ ï¼è®©æˆ‘ä»¬ä¸€èµ·åˆ›é€ ç¾å¥½çš„å›å¿†å§ï¼â¤` 
                : `è°¢è°¢ä½ çš„å–œæ¬¢ï¼Œä½†æˆ‘è¿˜éœ€è¦ä¸€äº›æ—¶é—´è€ƒè™‘...`;
            
            document.getElementById('responseText').textContent = responseText;
            
            // æ£€æŸ¥æ˜¯å¦æœ‰åˆ›å»ºè€…åœ¨ç­‰å¾…ç»“æœ
            checkForCreator(name, choice, resultUrl.toString());
        }
        
        // æ£€æŸ¥æ˜¯å¦æœ‰åˆ›å»ºè€…åœ¨ç­‰å¾…ç»“æœ
        function checkForCreator(name, choice, resultUrl) {
            const waitingName = localStorage.getItem('waitingForResponse');
            if (waitingName && waitingName === name) {
                // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥å‘é€åˆ°æœåŠ¡å™¨æˆ–ä½¿ç”¨å…¶ä»–æ–¹å¼é€šçŸ¥åˆ›å»ºè€…
                // è¿™é‡Œåªæ˜¯ç®€å•åœ°åœ¨æ§åˆ¶å°æ‰“å°
                console.log(`é€šçŸ¥åˆ›å»ºè€…: ${name}çš„é€‰æ‹©æ˜¯ ${choice ? 'æ„¿æ„' : 'ä¸æ„¿æ„'}`);
                console.log(`åˆ›å»ºè€…å¯ä»¥è®¿é—®: ${resultUrl}`);
                
                // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨:
                // 1. WebSocketå®æ—¶é€šçŸ¥
                // 2. æœåŠ¡å™¨è½®è¯¢
                // 3. é‚®ä»¶/çŸ­ä¿¡é€šçŸ¥
                // 4. è®©åˆ›å»ºè€…æ‰‹åŠ¨åˆ·æ–°ç»“æœé¡µé¢
            }
        }
        
        // å®šæœŸæ£€æŸ¥ç»“æœï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…åº”ç”¨ä¸­åº”è¯¥ä½¿ç”¨æ›´å¯é çš„æ–¹æ³•ï¼‰
        function checkResponse() {
            const waitingName = localStorage.getItem('waitingForResponse');
            if (waitingName && fromParam === 'creator') {
                // è¿™é‡Œåº”è¯¥ä»æœåŠ¡å™¨è·å–å®é™…ç»“æœ
                // è¿™é‡Œåªæ˜¯æ¼”ç¤º
                if (choiceParam) {
                    const resultText = choiceParam === 'true' 
                        ? `å¥½æ¶ˆæ¯ï¼${nameParam}æ¥å—äº†ä½ çš„è¡¨ç™½ï¼ğŸ‰` 
                        : `${nameParam}è¿˜éœ€è¦æ—¶é—´è€ƒè™‘...`;
                    document.getElementById('resultDisplay').textContent = resultText;
                }
            }
        }
        
        // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡ç»“æœï¼ˆç®€åŒ–ç‰ˆï¼‰
        setInterval(checkResponse, 5000);
    </script>
</body>
</html>
